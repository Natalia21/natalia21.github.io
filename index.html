<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø–æ–ª—ë—Ç</title>
<style>
  body, html { margin: 0; padding: 0; overflow: hidden; background: black; }
  canvas { display: block; }
</style>
</head>
<body>
  <button id="start"> start </button>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let shipX = 0; // —Å–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è –ø–æ X
let shipY = 0; // —Å–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è –ø–æ Y

let meteors = [];

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

window.addEventListener('resize', resize);
resize();

document.getElementById('start').addEventListener('click', () => {
  if (typeof DeviceMotionEvent.requestPermission === 'function') {
    DeviceMotionEvent.requestPermission()
      .then(permissionState => {
        alert(permissionState);
        if (permissionState === 'granted') {
          window.addEventListener('deviceorientation', handleOrientation);
        } else {
          alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ–Ω—Å–æ—Ä–∞–º üòî');
        }
      })
      .catch(console.error);
  } else {
    // –î–ª—è Android –∏–ª–∏ —Å—Ç–∞—Ä—ã—Ö iOS
    window.addEventListener('deviceorientation', handleOrientation);
  }
});

function handleOrientation(e) {
  if (e.gamma !== null && e.beta !== null) {
    // gamma - –Ω–∞–∫–ª–æ–Ω –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ, beta - –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥
    shipX = e.gamma;  // –ø—Ä–∏–º–µ—Ä–Ω–æ –æ—Ç -90 –¥–æ +90
    shipY = e.beta;   // –ø—Ä–∏–º–µ—Ä–Ω–æ –æ—Ç -180 –¥–æ +180
  }
};

function spawnMeteor() {
  meteors.push({
    x: Math.random() * canvas.width,
    y: -50,
    size: 20 + Math.random() * 30,
    speed: 2 + Math.random() * 3
  });
}

setInterval(spawnMeteor, 1000); // –∫–∞–∂–¥—ã–µ 1 —Å–µ–∫—É–Ω–¥–∞

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // –ù–∞—Ä–∏—Å—É–µ–º —Ñ–æ–Ω - –∑–≤—ë–∑–¥—ã
  for (let i = 0; i < 50; i++) {
    ctx.fillStyle = "white";
    ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 2, 2);
  }

  // –ù–∞—Ä–∏—Å—É–µ–º –∫–æ—Ä–∞–±–ª—å
  const x = canvas.width/2 + shipX*10;  // –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  const y = canvas.height/2 + shipY*5;
  ctx.fillStyle = "lime";
  ctx.beginPath();
  ctx.moveTo(x, y);
  ctx.lineTo(x-15, y+30);
  ctx.lineTo(x+15, y+30);
  ctx.closePath();
  ctx.fill();

  // –º–µ—Ç–µ–æ—Ä–∏—Ç—ã
  ctx.fillStyle = "gray";
  for (let i = 0; i < meteors.length; i++) {
    const m = meteors[i];
    m.y += m.speed;
    ctx.beginPath();
    ctx.arc(m.x, m.y, m.size / 2, 0, Math.PI * 2);
    ctx.fill();
  }

  // –£–¥–∞–ª–∏–º –º–µ—Ç–µ–æ—Ä–∏—Ç—ã –∑–∞ —ç–∫—Ä–∞–Ω–æ–º
  meteors = meteors.filter(m => m.y < canvas.height + m.size);

  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
